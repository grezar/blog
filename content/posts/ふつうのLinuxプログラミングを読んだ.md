---
title: "ふつうのLinuxプログラミングを読んだ"
date: 2018-12-30T21:47:41+09:00
draft: false
---

意気揚々とスタートしたこのブログも初回の自己紹介から4ヶ月未更新。とほほ。気合を入れ直して記事を投下します。

## ふつうのLinuxプログラミング
[ふつうのLinuxプログラミング](https://www.amazon.co.jp/%E3%81%B5%E3%81%A4%E3%81%86%E3%81%AELinux%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-%E7%AC%AC2%E7%89%88-Linux%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B9%E3%82%8Bgcc%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E7%8E%8B%E9%81%93-%E9%9D%92%E6%9C%A8-%E5%B3%B0%E9%83%8E/dp/4797386479)の第2版を読みました。この本の概要は以下です。

```
本書はLinuxプログラミングの入門書です。つまり、本書を読むことで読者のみなさんがLinux向けのプログラムをバリバリと作れるようになる、あるいはそこまでいかなくとも、そうなるために何が必要なのか判断できるようになることを目標としています。
では、本書はどのような道筋をたどってその目標を達成するのでしょうか。簡単です。本書がやることはただ1つ、「Linux世界が何によってできているのか」を教えることです。
―まえがきより抜粋
```

要するにLinuxカーネルのシステムコールであったり、ライブラリ関数を利用していくつかのコマンドや、HTTPサーバーを作成して、Linuxでのプログラミングを学んでいくという内容の本です。
Linuxのファイルシステムやプロセス、ストリームと言った概念についても解説をしており、Cを書く機会とLinuxの仕組みについて学ぶことを目的としてこの本を手に取りました。

ただ読んだだけではなかなか身につかないので、自分の中で気になったところをこの記事に読書記録としてまとめてアウトプットしておこうと思います。少しずつ更新予定。
## 目次

- 第1章 Linuxプログラミングを始めよう
  - 1.5 [コマンドライン引数](#コマンドライン引数)
- 第3章 Linuxを描き出す3つの概念
  - 3.1 ファイルシステム
  - 3.2 プロセス
  - 3.3 ストリーム
  - 3.4 3大重要概念のまとめ
- 第5章 ストリームに関わるシステムコール
  - 5.2 ファイルディスクリプタ
  - 5.4 ストリームの読み書き



## 第1章 Linuxプログラミングを始めよう

### コマンドライン引数
コマンドライン引数がmain関数にどのように渡されるかという話。

```
#include <stdio.h>

int
main(int argc, char *argv[])
{
    printf("Hello, World!\n");
    return 0;
}
```

この`argc`と`argv`がコマンドライン引数を表しています。

`argc` はコマンドライン引数の数が、 `argv` はコマンドライン引数の実体が文字列の配列として格納されています。
この時注意しなければならないのはコマンドライン引数にはコマンド自体が含まれているということです。
例えば

```
echo x y z
```
というコマンドを実行した時`argc`はecho自体を含めた4、`argv`の中身は"echo", "x", "y", "z"となります。
もちろん`argc`と`argv`という変数名は任意です。

#### サンプルコード

args.c
```
#include <stdio.h>
#include <stdlib.h>

int
main(int argcount, char *args[])
{
    int i;

    printf("argcount=%d\n", argcount);
    for (i = 0; i < argcount; i++) {
        printf("args[%d]=%s\n", i, args[i]);
    }
    exit(0);
}
```

```
$ gcc -o args args.c
$ ./args a b c
argcount=4
args[0]=./args
args[1]=a
args[2]=b
args[3]=c
```

## 第3章 Linuxを描き出す3つの概念

### ファイルシステム

ファイルシステムとはファイルにファイルとしての特徴を持たせるのである。ではファイルの特徴とは何か。
一口にファイルと言っても多くの意味を持っている。

#### ファイルの特徴
例えば`ls`コマンドを打ったときにテキストファイルやバイナリファイルやシンボリックリンク、あるいはディレクトリなどが表示される。
これらはすべて広義の意味でのファイルと捉えることができる。
広義のファイルは細かく分類できる。

**普通のファイル**

テキストファイルや画像ファイルなどのように何らかのデータが記録されているファイル（データという単語もかなり広い意味を持っているが...)。

**ディレクトリ**

ディレクトリは複数のファイルを入れることができるファイルと捉えることができる。

**シンボリックリンク**

他のファイルの別名を記録したファイル。

**デバイスファイル**
ハードウェアをファイルとして表現したもの。例えば`df`コマンドを打ったときに表示される`/dev/sda1`などがそれ。

その他名前付きパイプやUNIXドメインソケットなども広義の意味でファイルに含まれる。

ファイルの特徴としては以下のものが挙げられる。

1. データを保持する

1. 付帯情報を持つ

`ls -l` で確認できるようにファイルの作成、更新日時やファイルの所有権などの付帯情報を持っている。

1. 名前で指定できる
パスによって名前を指定できる。

このようなファイルとしての特徴をファイルに持たせるのがファイルシステムだと言える。

### プロセス

プロセスとは動作中のプログラムである。プログラムとはテキストデータとして存在している状態も含む言葉。
ひとつのプログラムから複数のプロセスを起動することができる。したがって動作中のプログラムの名前だけではプロセスを一意に特定できない。
そこでプロセスIDが用いられる。

### ストリーム
この本独自にバイト列が流れる道をストリームと呼んでいる。この概念によって説明をシンプルにまとめることに成功している箇所がいくつもあり、この独自の概念は非常に有用だと思った。
ストリームが使われる場所としてプロセスからのファイルへのアクセス（read、 write)や、パイプ、プロセス間通信、ネットワーク通信などがあげられる。

## 第5章 ストリームに関わるシステムコール

### 5.2 ファイルディスクリプタ
ファイルディスクリプタはストリームを表す整数値。標準入力、標準出力、標準エラー出力などのように標準で用意されているものもあればopenなどのシステムコールを使って新たにストリームを作成し、ファイルディスクリプタを得ることもできる。

### 5.4 ストリームの読み書き
